# This tests that BLAST on two lists only does one search per duplicate
# element. It mainly guards against bugs in naming the hashed tmpfiles.

# TODO Is it having the same issue the overall cut is having? Maybe crb-blast
#      fails partway through and returns [] instead of actually failing!

reference = load_fna "data/Mycoplasma_genitalium_M2321_single.fna"

small = load_faa_each ["data/Mycoplasma_genitalium_M2321_10genes.faa"]
large = load_faa_each ["data/Mycoplasma_agalactiae_small.faa"] | small

# Only one BLAST search should be done against each of the genomes
# in "small" because the result should be reused in "large".
small_hits = extract_queries_each (crb_blast_each reference small)
large_hits = extract_queries_each (crb_blast_each reference large)

# The real test is that it produces the expected tmpfiles,
# but result should also be 40.
result = length (any large_hits ~ any small_hits)
