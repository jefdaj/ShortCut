# This tests that BLAST on two lists only does one search per duplicate
# element. It mainly guards against bugs in naming the hashed tmpfiles.

# TODO Is it having the same issue the overall cut is having? Maybe crb-blast
#      fails partway through and returns [] instead of actually failing!

reference = gbk_to_fna (load_gbk "data/SynPCC7942_chr.gbk")

# TODO how does this have 12 hits? shouldn't it be up to 10?
small = load_faa_each ["data/7942genes10.faa"]

large = load_faa_each ["data/7942genes50.faa"] | small

# Only one BLAST search should be done against each of the genomes
# in "small" because the result should be reused in "large".
small_hits = extract_queries_each (crb_blast_each reference small)
large_hits = extract_queries_each (crb_blast_each reference large)

# The real test is that it produces the expected tmpfiles,
# but result should also be 40.
result = length (any large_hits ~ any small_hits)
