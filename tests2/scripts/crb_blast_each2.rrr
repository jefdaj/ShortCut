# This tests that the tmpfiles produced by a mapped function include the ones
# from its single equivalent. And also that the mapped tmpfile paths don't
# include varnames. (There's no good way to confirm that other than manual
# inspection of the tree for now, because of the tmpfiles race condition)

# TODO fix (minor) race condition between mapped and single tmpfile trees
# TODO don't use crb-blast for this since it's still nondeterministic?

mini6803 = load_fna "data/Mycoplasma_genitalium_M2321_10genes.fna"
maga = load_faa "data/Mycoplasma_agalactiae_small.faa"
single = crb_blast      mini6803  maga
mapped = crb_blast_each mini6803 [maga]
result = length ([single] | mapped) # should be 1
